<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESP32 Wi-Fi Configurator with Auto Connect</title>
<script>
document.addEventListener('DOMContentLoaded', function() {
    let serialPort;
    const monitorTextarea = document.getElementById('monitorTextarea');
    const ssidInput = document.getElementById('ssid');
    const passwordInput = document.getElementById('password');
    const connectButton = document.getElementById('connectButton');

    // Automatically request port on page load
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            serialPort = await navigator.serial.requestPort();
            await serialPort.open({ baudRate: 115200 });
            console.log('Serial port connected and opened');
            // Setup data received event listener
            const decoder = new TextDecoder();
            serialPort.on('datareceived', event => {
                const data = decoder.decode(event.data);
                monitorTextarea.value += data; // Append incoming data to textarea
            });
        } catch (error) {
            console.error('Error connecting to serial port:', error);
        }
    });

    // Send configuration to ESP32
    connectButton.addEventListener('click', async function() {
        try {
            if (!serialPort) {
                throw new Error('Serial port not connected');
            }
            const encoder = new TextEncoder();
            const ssid = ssidInput.value;
            const password = passwordInput.value;
            const command = `AT+CONFIG=wifi,ssid,${ssid};password,${password}\n`;
            await serialPort.write(encoder.encode(command));
            console.log('Configuration command sent');
        } catch (error) {
            console.error('Error sending configuration:', error);
        }
    });
});
</script>
</head>
<body>
<h1>ESP32 Wi-Fi Configurator</h1>
<form>
    <label for="ssid">SSID:</label>
    <input type="text" id="ssid" name="ssid" required><br>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required><br>
    <button type="button" id="connectButton">Upload Configuration</button>
</form>
<h2>Monitor</h2>
<p>ESP32 responses and status will be displayed here:</p>
<textarea id="monitorTextarea" rows="10" cols="50" readonly></textarea>
</body>
</html>
