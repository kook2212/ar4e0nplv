<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ESP32 WiFi Configuration</title>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('configure').addEventListener('click', configureWiFi);
        });

        async function configureWiFi() {
            try {
                // 请求串行端口
                const port = await navigator.serial.requestPort();
                
                // 打开端口
                const options = { baudRate: 115200 };
                await port.open(options);
                
                // 确认端口已打开
                if (!(port.readable && port.writable)) {
                    throw new Error('Failed to open the port properly.');
                }

                // 获取用户输入的WiFi信息
                const ssid = document.getElementById('ssid').value;
                const password = document.getElementById('password').value;

                // 构建AT指令
                const command = `AT+CWJAP_DEF="${ssid}","${password}"\r\n`;

                // 发送AT指令
                const encoder = new TextEncoder();
                const encodedCommand = encoder.encode(command);
                await port.writable.write(encodedCommand);

                // 读取响应（根据ESP32的实际响应情况调整）
                const reader = port.readable.getReader();
                let response = '';
                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;
                    response += new TextDecoder().decode(value);
                }
                console.log('ESP32 Response:', response);

                // 关闭端口
                await port.close();

                alert('WiFi configuration sent.');
            } catch (error) {
                console.error('Error configuring WiFi:', error);
                if (port) {
                    await port.close();
                }
                alert('Error configuring WiFi: ' + error.message);
            }
        }
    </script>
</head>
<body>
    <h1>ESP32 WiFi Configuration</h1>
    <label for="ssid">SSID:</label>
    <input type="text" id="ssid" name="ssid" required>
    <br><br>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required>
    <br><br>
    <button id="configure">Configure WiFi</button>
</body>
</html>
